generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum AuthProvider {
  CREDENTIALS
  GOOGLE
}

model User {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  username  String   @unique

  // For Password Login
  password  String? 

  // OAuth
  provider String?

  //Magic Link
  magicToken String?
  magicExpiresAt DateTime?
  code String?

  createdAt DateTime @default(now())
  workSpace WorkSpaceSection[]
  formData FormData[]
  formResponse ResponseFromUser[]
}

model WorkSpaceSection {
  id  String  @id @default(auto()) @map("_id") @db.ObjectId
  workspaceId String @default(uuid())
  workspacename String
  isDeleted Boolean @default(false)
  forms FormData[]

  userId String @db.ObjectId
  user User @relation(fields: [userId],references: [id],onDelete:Cascade)

  @@map("workspaces")
  @@index([userId])
}

model FormData {
  id    String  @id @default(auto()) @map("_id") @db.ObjectId
  formId String @default(uuid()) @unique

  workspaceId String @db.ObjectId

  workspace WorkSpaceSection @relation(fields: [workspaceId],references: [id],onDelete:Cascade)

  userId String @db.ObjectId
  user User @relation(fields: [userId],references: [id],onDelete:Cascade)

  questions FormQuestions[]
  formSettings FormSettingConfiguration?
  formDesign FormDesignConfigurationSetting?
  headerConfig FormHeaderConfiguration?
  responsefromUsers ResponseFromUser[]


  @@map("forms")
}

model FormHeaderConfiguration {
  id       String @id @default(auto()) @map("_id") @db.ObjectId

  formId   String @unique @db.ObjectId
  form     FormData @relation(fields: [formId], references: [id], onDelete: Cascade)

  formTitle        String?
  titlePlaceholder String?
  isTitleBold      Boolean? @default(false)
  isTitleItalic   Boolean? @default(false)
  isTitleUnderline Boolean? @default(false)
  titleAlign       String?

  formDescription        String?
  descriptionPlaceholder String?
  isDescriptionBold      Boolean? @default(false)
  isDescriptionItalic   Boolean? @default(false)
  isDescriptionUnderline Boolean? @default(false)
  descriptionAlign       String?

  @@map("form_header_config")
}


model FormQuestions{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  uuid String @default(uuid()) @unique

  required Boolean
  title String?
  type String
  options Json

  formId String @db.ObjectId
  form FormData @relation(fields: [formId],references: [id],onDelete:Cascade)

}

model FormSettingConfiguration{
  id String @id @default(auto()) @map("_id") @db.ObjectId

  formId String @unique @db.ObjectId
  form FormData @relation(fields: [formId],references: [id],onDelete:Cascade)

  limitResponseToOne Boolean
  requiredSignIn Boolean
  responseConfirmationMessage String
  showLinkToSubmitAnotherResponse Boolean
  showProgressBar Boolean
  shuffleQuestionOrder Boolean
  isPublished Boolean

}

model FormDesignConfigurationSetting{
   id String @id @default(auto()) @map("_id") @db.ObjectId

  formId String @unique @db.ObjectId
  form FormData @relation(fields: [formId],references: [id],onDelete:Cascade)

  colorConfiguration Json
  headerDesign Json
  headerImage String?
  questionDesign Json
  textDesign Json
}

model ResponseFromUser {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  formId   String @db.ObjectId
  form     FormData @relation(fields: [formId], references: [id], onDelete: Cascade)

  userId String @unique @db.ObjectId
  User User @relation(fields: [userId],references: [id],onDelete:Cascade)

  response Json?
  
  ipAddress String?
  submittedAt DateTime @default(now())
  isSubmitted Boolean @default(false)
}


model FileUpload {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  questionId   String
  fileName     String
  fileUrl      String
  fileSize     Int?
  mimeType     String?
  uploadedAt   DateTime @default(now())

  @@map("file_uploads")
}